var X=Object.defineProperty,$=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var D=(a,r,s)=>r in a?X(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s,C=(a,r)=>{for(var s in r||(r={}))Q.call(r,s)&&D(a,s,r[s]);if(I)for(var s of I(r))Y.call(r,s)&&D(a,s,r[s]);return a},E=(a,r)=>$(a,G(r));var u=(a,r,s)=>new Promise((b,y)=>{var j=m=>{try{d(s.next(m))}catch(x){y(x)}},c=m=>{try{d(s.throw(m))}catch(x){y(x)}},d=m=>m.done?b(m.value):Promise.resolve(m.value).then(j,c);d((s=s.apply(a,r)).next())});import{j as e,L as P,U as F,i as M,k as Z,X as ee,l as se,n as _,o as te,p as re,q as ae,r as ne,s as le}from"./ui-libs-D7quiBqG.js";import{b as oe,r as i}from"./react-vendor-DREZjZ3y.js";import{u as ie,j as f,P as me,i as de}from"./index-vFyLetUi.js";const ue=()=>{const a=oe(),r=ie(),[s,b]=i.useState(null),[y,j]=i.useState(!0),[c,d]=i.useState(!1),[m,x]=i.useState(!1),[n,N]=i.useState({name:"",phone:"",bio:""}),[h,w]=i.useState({}),[A,T]=i.useState([]),[B,L]=i.useState(!1),[v,O]=i.useState(""),[g,q]=i.useState(!1);i.useEffect(()=>{if(!localStorage.getItem("token")){a("/login");return}S()},[a]);const S=()=>u(void 0,null,function*(){var t,l;try{j(!0);const o=yield f.getCurrentUser();o.user&&(b(o.user),N({name:o.user.name||"",phone:o.user.phone||"",bio:o.user.bio||""}))}catch(o){console.error("Error fetching profile:",o),r.error(o.message||"Failed to load profile"),((t=o.message)!=null&&t.includes("token")||(l=o.message)!=null&&l.includes("unauthorized"))&&(localStorage.removeItem("token"),localStorage.removeItem("user"),a("/login"))}finally{j(!1)}}),z=()=>{const t={};return!n.phone||!n.phone.trim()?t.phone="Phone number is required":de(n.phone)||(t.phone="Please enter a valid phone number (with country code)"),n.bio&&n.bio.length>500&&(t.bio="Bio must be less than 500 characters"),w(t),Object.keys(t).length===0},U=t=>{const{name:l,value:o}=t.target;N(k=>E(C({},k),{[l]:o})),h[l]&&w(k=>E(C({},k),{[l]:""}))},R=()=>u(void 0,null,function*(){if(z())try{x(!0);const t=yield f.updateProfile({name:n.name.trim()||null,phone:n.phone.trim(),bio:n.bio.trim()||null});t.user&&(b(t.user),localStorage.setItem("user",JSON.stringify(t.user)),window.dispatchEvent(new Event("authChange")),d(!1),r.success("Profile updated successfully!"))}catch(t){console.error("Error updating profile:",t),r.error(t.message||"Failed to update profile")}finally{x(!1)}}),H=()=>{N({name:(s==null?void 0:s.name)||"",phone:(s==null?void 0:s.phone)||"",bio:(s==null?void 0:s.bio)||""}),w({}),d(!1)},J=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),window.dispatchEvent(new Event("authChange")),a("/login"),r.success("Logged out successfully")},p=()=>u(void 0,null,function*(){try{L(!0);const t=yield f.getAllUsers(v);T(t.users||[])}catch(t){console.error("Error fetching users:",t),r.error(t.message||"Failed to load users")}finally{L(!1)}}),K=t=>u(void 0,null,function*(){try{yield f.promoteUser(t),r.success("User promoted to admin successfully!"),p(),S()}catch(l){console.error("Error promoting user:",l),r.error(l.message||"Failed to promote user")}}),V=t=>u(void 0,null,function*(){try{yield f.demoteUser(t),r.success("User demoted successfully!"),p(),S()}catch(l){console.error("Error demoting user:",l),r.error(l.message||"Failed to demote user")}});i.useEffect(()=>{g&&(s==null?void 0:s.role)==="main_admin"&&p()},[g,v,s==null?void 0:s.role]);const W=t=>t==="main_admin"?e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-semibold",children:"Main Admin"}):t==="admin"?e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-semibold",children:"Admin"}):e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-semibold",children:"User"});return y?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-emerald-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"w-12 h-12 animate-spin text-[#017233] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading profile..."})]})}):s?e.jsx("div",{className:"min-h-screen bg-white py-6 sm:py-8 md:py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-black bg-gradient-to-r from-[#017233] via-[#01994d] to-[#00C853] bg-clip-text text-transparent mb-2",children:"My Profile"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Manage your account information and preferences"})]}),e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-xl border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#017233] via-[#01994d] to-[#00C853] px-4 sm:px-6 md:px-8 py-6 sm:py-8 md:py-12 relative",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-4 sm:gap-6",children:[e.jsx("div",{className:"relative",children:s.picture?e.jsx("img",{src:s.picture,alt:s.name||s.email,className:"w-24 h-24 sm:w-28 sm:h-28 md:w-32 md:h-32 rounded-full border-4 border-white shadow-lg object-cover"}):e.jsx("div",{className:"w-24 h-24 sm:w-28 sm:h-28 md:w-32 md:h-32 rounded-full border-4 border-white shadow-lg bg-gradient-to-br from-[#01994d] to-[#00C853] flex items-center justify-center",children:e.jsx(F,{className:"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 text-white"})})}),e.jsxs("div",{className:"flex-1 text-center sm:text-left min-w-0",children:[e.jsx("h2",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-white mb-2 truncate",children:s.name||"User"}),e.jsxs("div",{className:"flex items-center justify-center sm:justify-start gap-2 text-white/90 mb-3 sm:mb-4",children:[e.jsx(M,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm sm:text-base truncate",children:s.email})]}),s.role&&e.jsx("span",{className:`inline-block px-3 py-1 backdrop-blur-sm text-white rounded-full text-sm font-semibold ${s.role==="main_admin"?"bg-red-500/30 border border-red-300/50":s.role==="admin"?"bg-yellow-500/30 border border-yellow-300/50":"bg-white/20"}`,children:s.role==="main_admin"?"Main Administrator":s.role==="admin"?"Administrator":"User"})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 w-full sm:w-auto",children:c?e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:H,disabled:m,className:"px-4 sm:px-6 py-2 sm:py-3 bg-white/20 backdrop-blur-sm text-white rounded-lg sm:rounded-xl font-bold hover:bg-white/30 transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-50 text-sm sm:text-base",children:[e.jsx(ee,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Cancel"]}),e.jsx("button",{onClick:R,disabled:m,className:"px-4 sm:px-6 py-2 sm:py-3 bg-white text-[#017233] rounded-lg sm:rounded-xl font-bold hover:bg-green-50 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center justify-center gap-2 disabled:opacity-50 text-sm sm:text-base",children:m?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 sm:w-5 sm:h-5 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Save Changes"]})})]}):e.jsxs("button",{onClick:()=>d(!0),className:"px-4 sm:px-6 py-2 sm:py-3 bg-white text-[#017233] rounded-lg sm:rounded-xl font-bold hover:bg-green-50 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center justify-center gap-2 text-sm sm:text-base",children:[e.jsx(Z,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Edit Profile"]})})]})}),e.jsx("div",{className:"p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Full Name"}),c?e.jsx("input",{type:"text",name:"name",value:n.name,onChange:U,placeholder:"Enter your full name",className:"w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[#017233] focus:border-[#017233] outline-none transition-all duration-300 text-sm sm:text-base"}):e.jsx("div",{className:"px-3 sm:px-4 py-2 sm:py-3 bg-gray-50 rounded-lg sm:rounded-xl text-gray-900 text-sm sm:text-base",children:s.name||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 bg-gray-50 rounded-lg sm:rounded-xl text-gray-600 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(M,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.email})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Email cannot be changed"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-2",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),c?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-400 flex-shrink-0"}),e.jsx(me,{value:n.phone,onChange:t=>U({target:{name:"phone",value:t}}),error:!!h.phone,placeholder:"Enter your phone number",className:"flex-1 rounded-lg sm:rounded-xl"})]}),h.phone&&e.jsx("p",{className:"mt-1 text-xs sm:text-sm text-red-600",children:h.phone})]}):e.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 bg-gray-50 rounded-lg sm:rounded-xl text-gray-900 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(_,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-400 flex-shrink-0"}),e.jsx("span",{children:s.phone||"Not set"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-semibold text-gray-700 mb-2",children:"Bio"}),c?e.jsxs("div",{children:[e.jsx("textarea",{name:"bio",value:n.bio,onChange:U,placeholder:"Tell us about yourself...",rows:4,maxLength:500,className:"w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:ring-2 focus:ring-[#017233] focus:border-[#017233] outline-none transition-all duration-300 resize-none text-sm sm:text-base"}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[h.bio&&e.jsx("p",{className:"text-xs sm:text-sm text-red-600",children:h.bio}),e.jsxs("p",{className:"text-xs text-gray-500 ml-auto",children:[n.bio.length,"/500 characters"]})]})]}):e.jsx("div",{className:"px-3 sm:px-4 py-2 sm:py-3 bg-gray-50 rounded-lg sm:rounded-xl text-gray-900 min-h-[80px] sm:min-h-[100px] text-sm sm:text-base",children:s.bio||"No bio added yet"})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Account Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Member Since"}),e.jsx("p",{className:"text-gray-900 font-medium",children:s.createdAt?new Date(s.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Last Updated"}),e.jsx("p",{className:"text-gray-900 font-medium",children:s.updatedAt?new Date(s.updatedAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"})]})]})]}),s.role==="main_admin"&&e.jsxs("div",{className:"pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"User Management"]}),e.jsxs("button",{onClick:()=>{q(!g),g||p()},className:"px-4 py-2 bg-gradient-to-r from-[#017233] to-[#01994d] text-white rounded-lg font-semibold hover:from-[#015a28] hover:to-[#017233] transition-all duration-300 flex items-center gap-2 shadow-lg hover:shadow-xl",children:[g?"Hide":"Show"," Users"]})]}),g&&e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search users by email or name...",value:v,onChange:t=>O(t.target.value),onKeyPress:t=>{t.key==="Enter"&&p()},className:"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-[#017233] focus:border-[#017233] outline-none transition-all duration-300"})]})}),B?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-[#017233]"})}):A.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found"}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:A.map(t=>e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200 flex items-center justify-between hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{children:t.picture?e.jsx("img",{src:t.picture,alt:t.name||t.email,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-[#01994d] to-[#00C853] flex items-center justify-center",children:e.jsx(F,{className:"w-6 h-6 text-white"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.name||"No name"}),e.jsx("p",{className:"text-sm text-gray-600",children:t.email})]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[W(t.role),t.role==="user"&&e.jsxs("button",{onClick:()=>K(t.id),className:"px-4 py-2 bg-green-100 text-green-700 rounded-lg font-semibold hover:bg-green-200 transition-all duration-300 flex items-center gap-2",title:"Promote to Admin",children:[e.jsx(ae,{className:"w-4 h-4"}),"Promote"]}),t.role==="admin"&&e.jsxs("button",{onClick:()=>V(t.id),className:"px-4 py-2 bg-orange-100 text-orange-700 rounded-lg font-semibold hover:bg-orange-200 transition-all duration-300 flex items-center gap-2",title:"Demote to User",children:[e.jsx(ne,{className:"w-4 h-4"}),"Demote"]}),t.role==="main_admin"&&e.jsx("span",{className:"px-4 py-2 bg-gray-100 text-gray-500 rounded-lg text-sm",children:"Cannot modify"})]})]},t.id))})]})]}),e.jsx("div",{className:"pt-6 border-t border-gray-200",children:e.jsxs("button",{onClick:J,className:"px-6 py-3 bg-red-50 text-red-600 rounded-xl font-bold hover:bg-red-100 transition-all duration-300 flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"Logout"]})})]})})]})]})}):null};export{ue as default};
