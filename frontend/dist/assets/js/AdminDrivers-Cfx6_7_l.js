var le=Object.defineProperty,oe=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var _=(l,r,a)=>r in l?le(l,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[r]=a,g=(l,r)=>{for(var a in r||(r={}))ie.call(r,a)&&_(l,a,r[a]);if(B)for(var a of B(r))ce.call(r,a)&&_(l,a,r[a]);return l},p=(l,r)=>oe(l,ne(r));var u=(l,r,a)=>new Promise((A,y)=>{var j=i=>{try{b(a.next(i))}catch(m){y(m)}},I=i=>{try{b(a.throw(i))}catch(m){y(m)}},b=i=>i.done?A(i.value):Promise.resolve(i.value).then(j,I);b((a=a.apply(l,r)).next())});import{j as e,L as K,K as de,y as ue,p as me,X as P,l as H,z as R,q as xe,r as he,k as ge,T as pe}from"./ui-libs-BFSs07BO.js";import{b as be,r as n}from"./react-vendor-3BC6cITN.js";import{u as fe,g as ve,i as v,j as W,m as ye}from"./index-DCzZaeNN.js";const ke=()=>{const l=be(),r=fe(),[a,A]=n.useState([]),[y,j]=n.useState(!0),[I,b]=n.useState(null),[i,m]=n.useState(!1),[E,w]=n.useState(!1),[N,M]=n.useState(null),[x,X]=n.useState(""),[Y,T]=n.useState(!1),[D,$]=n.useState(!1),[z,k]=n.useState({features:[],formFields:{}}),[c,C]=n.useState({name:"",car:"",experience:"",photoUrl:"",status:"active",displayOrder:0,fiveDriver:!1});n.useEffect(()=>{G()},[]);const G=()=>u(void 0,null,function*(){try{const s=yield ve.getCurrentUser();if(s.user){if(b(s.user),s.user.role!=="admin"&&s.user.role!=="main_admin"){r.error("Access denied. Admin privileges required."),l("/");return}S(),J()}}catch(s){console.error("Error checking auth:",s),r.error("Please login to continue"),l("/login")}}),S=()=>u(void 0,null,function*(){try{j(!0);const s=yield v.getAllDriversAdmin();A(s.drivers||[])}catch(s){console.error("Error fetching drivers:",s),r.error(s.message||"Failed to load drivers")}finally{j(!1)}}),J=()=>u(void 0,null,function*(){try{const s=yield W.getSettingsAdmin();k({features:s.features||[],formFields:s.formFields||{}})}catch(s){console.error("Error fetching settings:",s)}}),h=s=>{const{name:t,value:o,type:d,checked:L}=s.target;C(f=>p(g({},f),{[t]:d==="checkbox"?L:o}))},Q=s=>u(void 0,null,function*(){try{T(!0);const t=yield ye.uploadImage(s);C(o=>p(g({},o),{photoUrl:t.url,photoPublicId:t.public_id})),r.success("Photo uploaded successfully!")}catch(t){console.error("Error uploading file:",t),r.error(t.message||"Failed to upload photo")}finally{T(!1)}}),V=s=>u(void 0,null,function*(){s.preventDefault();try{N?(yield v.updateDriver(N.id,c),r.success("Driver updated successfully!")):(yield v.createDriver(c),r.success("Driver created successfully!")),F(),S()}catch(t){console.error("Error saving driver:",t),r.error(t.message||"Failed to save driver")}}),Z=s=>{M(s),C({name:s.name||"",car:s.car||"",experience:s.experience||"",photoUrl:s.photoUrl||"",status:s.status||"active",displayOrder:s.displayOrder||0,fiveDriver:s.fiveDriver||!1,photoPublicId:s.photoPublicId}),m(!0)},ee=s=>u(void 0,null,function*(){if(window.confirm("Are you sure you want to delete this driver? This action cannot be undone."))try{yield v.deleteDriver(s),r.success("Driver deleted successfully!"),S()}catch(t){console.error("Error deleting driver:",t),r.error(t.message||"Failed to delete driver")}}),q=(s,t)=>u(void 0,null,function*(){const o=a.find(f=>f.id===s);if(!o)return;const d=o.displayOrder||0,L=t==="up"?d-1:d+1;try{yield v.updateDriver(s,{displayOrder:L}),r.success("Driver order updated!"),S()}catch(f){console.error("Error updating order:",f),r.error("Failed to update order")}}),F=()=>{C({name:"",car:"",experience:"",photoUrl:"",status:"active",displayOrder:0,fiveDriver:!1}),M(null),m(!1)},se=()=>u(void 0,null,function*(){try{yield W.updateSettings(z),r.success("Settings saved successfully!"),w(!1)}catch(s){console.error("Error saving settings:",s),r.error(s.message||"Failed to save settings")}}),re=()=>{k(s=>p(g({},s),{features:[...s.features,""]}))},te=(s,t)=>{k(o=>{const d=[...o.features];return d[s]=t,p(g({},o),{features:d})})},ae=s=>{k(t=>p(g({},t),{features:t.features.filter((o,d)=>d!==s)}))},U=a.filter(s=>D&&!s.fiveDriver?!1:x?s.name.toLowerCase().includes(x.toLowerCase())||s.car.toLowerCase().includes(x.toLowerCase())||x.toLowerCase().includes("five")&&s.fiveDriver||x.toLowerCase().includes("5")&&s.fiveDriver||x.toLowerCase().includes("seater")&&s.fiveDriver:!0),O=a.filter(s=>s.fiveDriver);return y?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-purple-50",children:e.jsx(K,{className:"w-12 h-12 animate-spin text-blue-600"})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 pt-24 pb-8 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 sm:mb-8 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Manage Drivers & Car Booking"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600",children:"Manage driver profiles and car booking settings"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>w(!0),className:"w-full sm:w-auto px-4 sm:px-6 py-2 sm:py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 transition-all duration-300 flex items-center justify-center gap-2 shadow-lg hover:shadow-xl text-sm sm:text-base",children:[e.jsx(de,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"whitespace-nowrap",children:"Settings"})]}),e.jsxs("button",{onClick:()=>{F(),m(!0)},className:"w-full sm:w-auto px-4 sm:px-6 py-2 sm:py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-all duration-300 flex items-center justify-center gap-2 shadow-lg hover:shadow-xl text-sm sm:text-base",children:[e.jsx(ue,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"whitespace-nowrap",children:"Add Driver"})]})]})]}),!i&&!E&&e.jsxs("div",{className:"mb-4 sm:mb-6 space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("input",{type:"text",placeholder:"Search drivers by name or car...",value:x,onChange:s=>X(s.target.value),className:"w-full pl-9 sm:pl-10 pr-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-300"})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("button",{onClick:()=>$(!D),className:`px-4 py-2 rounded-lg font-semibold text-sm transition-all duration-300 flex items-center gap-2 ${D?"bg-blue-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Show Only 5 Seater Drivers",O.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-white/20 rounded-full text-xs",children:O.length})]}),D&&e.jsxs("span",{className:"text-sm text-gray-600",children:["Showing ",U.length," of ",O.length," five-seater drivers"]})]})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[200] flex items-center justify-center p-2 sm:p-4 overflow-y-auto pt-20 sm:pt-4",children:e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-2xl max-w-4xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto my-4",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 sm:p-6 flex items-center justify-between z-10 shadow-sm",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Car Booking Settings"}),e.jsx("button",{onClick:()=>w(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close",children:e.jsx(P,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Car Features"}),z.features.map((s,t)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:s,onChange:o=>te(t,o.target.value),className:"flex-1 px-4 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",placeholder:"Enter feature"}),e.jsx("button",{type:"button",onClick:()=>ae(t),className:"px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200",children:e.jsx(P,{className:"w-4 h-4"})})]},t)),e.jsx("button",{type:"button",onClick:re,className:"mt-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"+ Add Feature"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Form Fields"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Form fields are currently managed in the code. Future updates will allow full customization here."}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Available fields: First Name, Last Name, Mobile Number, Email, From Date, To Date, Number of Adults, Number of Children, Five Driver (5 Seater Car)"})})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t",children:[e.jsxs("button",{onClick:se,className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition-all flex items-center justify-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Save Settings"]}),e.jsx("button",{onClick:()=>w(!1),className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300 transition-all",children:"Cancel"})]})]})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[200] flex items-center justify-center p-2 sm:p-4 overflow-y-auto pt-20 sm:pt-4",children:e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-2xl max-w-2xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto my-4",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 sm:p-6 flex items-center justify-between z-10 shadow-sm",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:N?"Edit Driver":"Add New Driver"}),e.jsx("button",{onClick:F,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close",children:e.jsx(P,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),e.jsxs("form",{onSubmit:V,className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Name *"}),e.jsx("input",{type:"text",name:"name",value:c.name,onChange:h,required:!0,className:"w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",placeholder:"e.g., Mr. Anup Kumar"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Car *"}),e.jsx("input",{type:"text",name:"car",value:c.car,onChange:h,required:!0,className:"w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",placeholder:"e.g., Innova Crysta- 7 Seater"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Experience"}),e.jsx("input",{type:"text",name:"experience",value:c.experience,onChange:h,className:"w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",placeholder:"e.g., 35+ Years of Experience"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Photo"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>s.target.files[0]&&Q(s.target.files[0]),className:"hidden",id:"photo-upload"}),e.jsxs("label",{htmlFor:"photo-upload",className:"px-4 py-2 bg-blue-100 text-blue-700 rounded-lg font-semibold hover:bg-blue-200 transition-colors cursor-pointer flex items-center gap-2",children:[Y?e.jsx(K,{className:"w-4 h-4 animate-spin"}):e.jsx(R,{className:"w-4 h-4"}),"Upload Photo"]}),c.photoUrl&&e.jsx("img",{src:c.photoUrl,alt:"Preview",className:"w-20 h-20 object-cover rounded-lg"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{name:"status",value:c.status,onChange:h,className:"w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Display Order"}),e.jsx("input",{type:"number",name:"displayOrder",value:c.displayOrder,onChange:h,className:"w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",min:"0"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("input",{type:"checkbox",id:"fiveDriver",name:"fiveDriver",checked:c.fiveDriver,onChange:h,className:"w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500 cursor-pointer"}),e.jsx("label",{htmlFor:"fiveDriver",className:"text-sm font-semibold text-gray-700 cursor-pointer",children:"5 Seater Car / Five Driver"}),e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Mark this driver as available for 5-seater car bookings)"})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t",children:[e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition-all flex items-center justify-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),N?"Update Driver":"Create Driver"]}),e.jsx("button",{type:"button",onClick:F,className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300 transition-all",children:"Cancel"})]})]})]})}),!i&&!E&&e.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-xl border border-gray-200 overflow-hidden",children:U.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No drivers found"}):e.jsx("div",{className:"divide-y divide-gray-200",children:U.map(s=>e.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:s.photoUrl?e.jsx("img",{src:s.photoUrl,alt:s.name,className:"w-16 h-16 object-cover rounded-lg"}):e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(R,{className:"w-8 h-8 text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),s.fiveDriver&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-semibold bg-blue-100 text-blue-700 rounded-full",children:"5 Seater"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:s.car}),e.jsx("p",{className:"text-sm text-gray-500",children:s.experience})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>q(s.id,"up"),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Move up",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(s.id,"down"),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Move down",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Z(s),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Edit",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ee(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(pe,{className:"w-4 h-4"})})]})]})},s.id))})})]})})};export{ke as default};
