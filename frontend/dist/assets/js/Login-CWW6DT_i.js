var p=(f,l,d)=>new Promise((g,u)=>{var v=s=>{try{r(d.next(s))}catch(m){u(m)}},b=s=>{try{r(d.throw(s))}catch(m){u(m)}},r=s=>s.done?g(s.value):Promise.resolve(s.value).then(v,b);r((d=d.apply(f,l)).next())});import{j as e,L as S}from"./ui-libs-D7quiBqG.js";import{b as P,r as c,L as T}from"./react-vendor-DREZjZ3y.js";import{G as L,E as F,O as _}from"./OtpInput-CXyVSpwX.js";import{G as $,j}from"./index-vFyLetUi.js";const B=()=>{const f=P(),[l,d]=c.useState(""),[g,u]=c.useState(""),[v,b]=c.useState("email"),[r,s]=c.useState(!1),[m,i]=c.useState(""),[N,w]=c.useState(""),[E,y]=c.useState(""),I=o=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o),k=o=>p(void 0,null,function*(){if(o.preventDefault(),i(""),w(""),!l){w("Email is required");return}if(!I(l)){w("Please enter a valid email address");return}s(!0);try{const n=yield j.sendOTP(l);b("otp"),i(""),n.warning&&console.warn(n.warning)}catch(n){i(n.message)}finally{s(!1)}}),G=o=>p(void 0,null,function*(){if(o.preventDefault(),i(""),y(""),g.length!==4){y("Please enter the 4-digit OTP");return}s(!0);try{const n=yield j.verifyOTP(l,g,!1);localStorage.setItem("token",n.token),localStorage.setItem("user",JSON.stringify(n.user)),window.dispatchEvent(new Event("authChange")),f("/")}catch(n){y(n.message)}finally{s(!1)}}),O=()=>p(void 0,null,function*(){i(""),s(!0);try{const o=$;if(!window.google||!window.google.accounts)if(document.querySelector('script[src="https://accounts.google.com/gsi/client"]'))yield new Promise(t=>{if(window.google&&window.google.accounts)t();else{const a=setInterval(()=>{window.google&&window.google.accounts&&(clearInterval(a),t())},100);setTimeout(()=>{clearInterval(a),t()},5e3)}});else{const t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,document.head.appendChild(t),yield new Promise((a,h)=>{t.onload=()=>{setTimeout(a,1e3)},t.onerror=()=>h(new Error("Failed to load Google Sign-In script")),setTimeout(()=>h(new Error("Google Sign-In script load timeout")),15e3)})}if(!window.google||!window.google.accounts||!window.google.accounts.oauth2)throw new Error("Google Sign-In API is not available. Please refresh the page and try again.");window.google.accounts.oauth2.initTokenClient({client_id:o,scope:"openid email profile",callback:x=>p(void 0,null,function*(){try{if(x.error){i("Google authentication failed: "+x.error),s(!1);return}if(!x.access_token){i("No access token received from Google"),s(!1);return}const t=yield fetch(`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${x.access_token}`);if(!t.ok){const C=yield t.text();throw new Error(`Failed to fetch user info: ${t.status} ${C}`)}const a=yield t.json();if(!a.email)throw new Error("Email not provided by Google");const h=yield j.googleAuth(btoa(JSON.stringify({sub:a.id,email:a.email,name:a.name,picture:a.picture})));localStorage.setItem("token",h.token),localStorage.setItem("user",JSON.stringify(h.user)),window.dispatchEvent(new Event("authChange")),f("/")}catch(t){console.error("Error in Google Sign-In callback:",t);let a=t.message||"Failed to complete Google Sign-In";t.help&&(a=`${a}

ðŸ’¡ ${t.help}`),i(a),s(!1)}})}).requestAccessToken()}catch(o){console.error("Google Sign-In initialization error:",o),i(o.message||"Failed to initialize Google Sign-In. Please check your Google Client ID configuration."),s(!1)}});return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center px-4 sm:px-6 py-8 sm:py-12",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl sm:rounded-2xl shadow-xl p-6 sm:p-8",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-blue-600 mb-2",children:"Safe Hands Travels"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-800",children:"Welcome Back"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-2",children:"Login to your account"})]}),m&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm whitespace-pre-line",children:m}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(e.Fragment,{children:[e.jsx(L,{onClick:O,disabled:r,text:"Continue with Google"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with email"})})]})]}),v==="email"?e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx(F,{value:l,onChange:o=>{d(o.target.value),w("")},error:N,disabled:r,placeholder:"Enter your email"}),e.jsx("button",{type:"submit",disabled:r,className:"w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5 animate-spin"}),"Sending OTP..."]}):"Send OTP"})]}):e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4 text-center",children:["We've sent a 4-digit OTP to ",e.jsx("span",{className:"font-semibold",children:l})]}),e.jsx(_,{value:g,onChange:u,error:E,disabled:r})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{b("email"),u(""),y("")},disabled:r,className:"flex-1 border-2 border-gray-300 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-50 transition-all duration-200 disabled:opacity-50",children:"Change Email"}),e.jsx("button",{type:"submit",disabled:r,className:"flex-1 bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5 animate-spin"}),"Verifying..."]}):"Verify OTP"})]})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Don't have an account?"," ",e.jsx(T,{to:"/signup",className:"text-blue-600 font-semibold hover:text-blue-700",children:"Sign up"})]})})]})})};export{B as default};
