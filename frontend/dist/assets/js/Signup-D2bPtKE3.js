var x=(f,c,g)=>new Promise((u,h)=>{var v=s=>{try{n(g.next(s))}catch(m){h(m)}},w=s=>{try{n(g.throw(s))}catch(m){h(m)}},n=s=>s.done?u(s.value):Promise.resolve(s.value).then(v,w);n((g=g.apply(f,c)).next())});import{j as e,L as S}from"./ui-libs-CdhAi6Tc.js";import{b as T,r as d,L as C}from"./react-vendor-3BC6cITN.js";import{G as $,E as F,O as L}from"./OtpInput-CCZw5xan.js";import{G as A,g as j}from"./index-CRsNqYr4.js";const z=()=>{const f=T(),[c,g]=d.useState(""),[u,h]=d.useState(""),[v,w]=d.useState("email"),[n,s]=d.useState(!1),[m,l]=d.useState(""),[N,b]=d.useState(""),[E,y]=d.useState(""),I=o=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o),O=o=>x(void 0,null,function*(){if(o.preventDefault(),l(""),b(""),!c){b("Email is required");return}if(!I(c)){b("Please enter a valid email address");return}s(!0);try{const a=yield j.sendOTP(c);w("otp"),l(""),a.warning&&console.warn(a.warning)}catch(a){let i=a.message||"Failed to send OTP";a.help&&(i=`${i}

ðŸ’¡ ${a.help}`),l(i)}finally{s(!1)}}),G=o=>x(void 0,null,function*(){if(o.preventDefault(),l(""),y(""),u.length!==4){y("Please enter the 4-digit OTP");return}s(!0);try{const a=yield j.verifyOTP(c,u,!0);localStorage.setItem("token",a.token),localStorage.setItem("user",JSON.stringify(a.user)),window.dispatchEvent(new Event("authChange")),f("/")}catch(a){let i=a.message||"Failed to verify OTP";a.help&&(i=`${i}

ðŸ’¡ ${a.help}`),y(i)}finally{s(!1)}}),k=()=>x(void 0,null,function*(){l(""),s(!0);try{const o=A;if(!window.google||!window.google.accounts)if(document.querySelector('script[src="https://accounts.google.com/gsi/client"]'))yield new Promise(t=>{if(window.google&&window.google.accounts)t();else{const r=setInterval(()=>{window.google&&window.google.accounts&&(clearInterval(r),t())},100);setTimeout(()=>{clearInterval(r),t()},5e3)}});else{const t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,document.head.appendChild(t),yield new Promise((r,p)=>{t.onload=()=>{setTimeout(r,1e3)},t.onerror=()=>p(new Error("Failed to load Google Sign-In script")),setTimeout(()=>p(new Error("Google Sign-In script load timeout")),15e3)})}if(!window.google||!window.google.accounts||!window.google.accounts.oauth2)throw new Error("Google Sign-In API is not available. Please refresh the page and try again.");window.google.accounts.oauth2.initTokenClient({client_id:o,scope:"openid email profile",callback:i=>x(void 0,null,function*(){try{if(i.error){l("Google authentication failed: "+i.error),s(!1);return}if(!i.access_token){l("No access token received from Google"),s(!1);return}const t=yield fetch(`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${i.access_token}`);if(!t.ok){const P=yield t.text();throw new Error(`Failed to fetch user info: ${t.status} ${P}`)}const r=yield t.json();if(!r.email)throw new Error("Email not provided by Google");const p=yield j.googleAuth(btoa(JSON.stringify({sub:r.id,email:r.email,name:r.name,picture:r.picture})));localStorage.setItem("token",p.token),localStorage.setItem("user",JSON.stringify(p.user)),window.dispatchEvent(new Event("authChange")),f("/")}catch(t){console.error("Error in Google Sign-In callback:",t);let r=t.message||"Failed to complete Google Sign-In";t.help&&(r=`${r}

ðŸ’¡ ${t.help}`),l(r),s(!1)}})}).requestAccessToken()}catch(o){console.error("Google Sign-In initialization error:",o),l(o.message||"Failed to initialize Google Sign-In. Please check your Google Client ID configuration."),s(!1)}});return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center px-4 py-12",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-600 mb-2",children:"Safe Hands Travels"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Create Account"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Sign up to get started"})]}),m&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm whitespace-pre-line",children:m}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(e.Fragment,{children:[e.jsx($,{onClick:k,disabled:n,text:"Sign up with Google"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or sign up with email"})})]})]}),v==="email"?e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsx(F,{value:c,onChange:o=>{g(o.target.value),b("")},error:N,disabled:n,placeholder:"Enter your email"}),e.jsx("button",{type:"submit",disabled:n,className:"w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5 animate-spin"}),"Sending OTP..."]}):"Send OTP"})]}):e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4 text-center",children:["We've sent a 4-digit OTP to ",e.jsx("span",{className:"font-semibold",children:c})]}),e.jsx(L,{value:u,onChange:h,error:E,disabled:n})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{w("email"),h(""),y("")},disabled:n,className:"flex-1 border-2 border-gray-300 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-50 transition-all duration-200 disabled:opacity-50",children:"Change Email"}),e.jsx("button",{type:"submit",disabled:n,className:"flex-1 bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5 animate-spin"}),"Verifying..."]}):"Verify OTP"})]})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",e.jsx(C,{to:"/login",className:"text-blue-600 font-semibold hover:text-blue-700",children:"Login"})]})})]})})};export{z as default};
